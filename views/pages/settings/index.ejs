<% layout('layouts/layout') -%>
<% block('header', true) %>
<% block('sidebar', true) %>

<div class="max-w-4xl mx-auto mt-8 px-6">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 flex items-center">
      <i class="fas fa-cog mr-4 text-indigo-600"></i>
      Settings
    </h1>
    <p class="text-gray-600 mt-2">Manage your account settings and preferences</p>
  </div>

  <!-- Alert Messages -->
  <% if (typeof success !== 'undefined' && success) { %>
    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
      <div class="flex items-center">
        <i class="fas fa-check-circle text-green-500 mr-3"></i>
        <span class="text-green-700">
          <% if (success === 'profile') { %>
            Profile updated successfully!
          <% } else if (success === 'password') { %>
            Password changed successfully!
          <% } else { %>
            Settings updated successfully!
          <% } %>
        </span>
      </div>
    </div>
  <% } %>

  <% if (typeof error !== 'undefined' && error) { %>
    <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
      <div class="flex items-center">
        <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
        <span class="text-red-700">
          <% if (error === 'notfound') { %>
            Settings not found. Please try again.
          <% } else if (error === 'invalid') { %>
            Current password is incorrect.
          <% } else if (error === 'update') { %>
            Failed to update profile. Please try again.
          <% } else if (error === 'password') { %>
            Failed to change password. Please try again.
          <% } else { %>
            An error occurred: <%= error %>
          <% } %>
        </span>
      </div>
    </div>
  <% } %>

  <% if (!settings) { %>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center mb-8">
      <i class="fas fa-exclamation-triangle text-yellow-500 text-3xl mb-2"></i>
      <h2 class="text-xl font-bold text-yellow-700 mb-2">No settings found</h2>
      <p class="text-yellow-700">Your profile settings have not been set up yet. Please contact the administrator to initialize your account settings.</p>
    </div>
    <% return; %>
  <% } %>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Profile Settings -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
        <i class="fas fa-user mr-3 text-indigo-600"></i>
        Profile Information
      </h2>
      
      <form action="/settings/profile" method="POST" class="space-y-6">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-id-card mr-2"></i>
            Full Name
          </label>
          <input type="text" 
                 id="name" 
                 name="name" 
                 value="<%= settings?.name || '' %>" 
                 required 
                 class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                 placeholder="Enter your full name" />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-envelope mr-2"></i>
            Email Address
          </label>
          <input type="email" 
                 id="email" 
                 name="email" 
                 value="<%= settings?.email || '' %>" 
                 required 
                 class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                 placeholder="Enter your email address" />
        </div>

        <div>
          <label for="profileImage" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-image mr-2"></i>
            Profile Image URL
          </label>
          <input type="url" 
                 id="profileImage" 
                 name="profileImage" 
                 value="<%= settings?.profileImage || '' %>" 
                 class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                 placeholder="https://example.com/image.jpg" />
          <p class="text-xs text-gray-500 mt-1">Enter a URL to your profile image</p>
        </div>

        <div>
          <label for="bio" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-align-left mr-2"></i>
            Bio
          </label>
          <textarea id="bio" 
                    name="bio" 
                    rows="4" 
                    class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none" 
                    placeholder="Tell us about yourself..."><%= settings?.bio || '' %></textarea>
        </div>

        <div class="flex justify-end">
          <button type="submit" 
                  class="px-6 py-3 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
            <i class="fas fa-save mr-2"></i>
            Update Profile
          </button>
        </div>
      </form>
    </div>

    <!-- Security Settings -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
        <i class="fas fa-shield-alt mr-3 text-indigo-600"></i>
        Security Settings
      </h2>
      
      <form action="/settings/password" method="POST" class="space-y-6">
        <div>
          <label for="oldPassword" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-lock mr-2"></i>
            Current Password
          </label>
          <input type="password" 
                 id="oldPassword" 
                 name="oldPassword" 
                 required 
                 class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                 placeholder="Enter your current password" />
        </div>

        <div>
          <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-key mr-2"></i>
            New Password
          </label>
          <input type="password" 
                 id="newPassword" 
                 name="newPassword" 
                 required 
                 minlength="6"
                 class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                 placeholder="Enter your new password" />
          <p class="text-xs text-gray-500 mt-1">Password must be at least 6 characters long</p>
        </div>

        <div>
          <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-check-circle mr-2"></i>
            Confirm New Password
          </label>
          <input type="password" 
                 id="confirmPassword" 
                 name="confirmPassword" 
                 required 
                 minlength="6"
                 class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                 placeholder="Confirm your new password" />
        </div>

        <div class="flex justify-end">
          <button type="submit" 
                  class="px-6 py-3 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-colors">
            <i class="fas fa-key mr-2"></i>
            Change Password
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Account Information -->
  <div class="mt-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
      <i class="fas fa-info-circle mr-3 text-indigo-600"></i>
      Account Information
    </h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-500">Account Type:</span>
        <span class="font-medium">Administrator</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-500">Last Login:</span>
        <span class="font-medium">Just now</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-500">Account Status:</span>
        <span class="font-medium text-green-600">Active</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-500">Session:</span>
        <span class="font-medium">Secure</span>
      </div>
    </div>
  </div>
</div>

<script>
// Password confirmation validation
document.getElementById('confirmPassword').addEventListener('input', function() {
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = this.value;
  
  if (newPassword !== confirmPassword) {
    this.setCustomValidity('Passwords do not match');
  } else {
    this.setCustomValidity('');
  }
});

// Form validation
document.querySelector('form[action="/settings/password"]').addEventListener('submit', function(e) {
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  
  if (newPassword !== confirmPassword) {
    e.preventDefault();
    alert('Passwords do not match. Please try again.');
    return false;
  }
});
</script>
